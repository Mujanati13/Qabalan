// Simple test to verify we can access the correct payment URL
<!DOCTYPE html>
<html>
<head>
    <title>Payment Test - Fixed</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 600px; margin: 50px auto; padding: 20px; }
        .card { background: white; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); padding: 30px; margin: 20px 0; }
        .btn { background: #1677ff; color: white; padding: 12px 24px; border: none; border-radius: 6px; cursor: pointer; font-size: 16px; text-decoration: none; display: inline-block; }
        .btn:hover { background: #0f5ec5; }
        .test-order { background: #f8f9fa; padding: 15px; border-radius: 6px; margin: 10px 0; }
        .success { background: #d4edda; color: #155724; padding: 15px; border-radius: 6px; margin: 10px 0; }
        .error { background: #f8d7da; color: #721c24; padding: 15px; border-radius: 6px; margin: 10px 0; }
    </style>
</head>
<body>
    <h1>üîß MPGS Payment Test - FIXED</h1>
    
    <div class="card">
        <h2>The Problem:</h2>
        <p>You were accessing the session URL directly:</p>
        <code style="background: #ffebee; color: #c62828; padding: 5px; border-radius: 3px;">
            https://test-gateway.mastercard.com/checkout/version/73/merchant/TESTNITEST2/session/SESSION...
        </code>
        <p>‚ùå This URL is only for checkout.js script internal use, not direct browser access!</p>
    </div>

    <div class="card">
        <h2>‚úÖ The Solution:</h2>
        <p>Use these correct URLs instead:</p>
        
        <div class="test-order">
            <h3>1. Create Test Order First</h3>
            <button class="btn" onclick="createOrder()">Create Test Order</button>
            <div id="orderResult"></div>
        </div>
        
        <div class="test-order">
            <h3>2. Or Test with Existing Order</h3>
            <p>Use this URL format with any existing order ID:</p>
            <code>http://localhost:3015/api/payments/mpgs/payment/view?orders_id=12345</code>
            <br><br>
            <a href="http://localhost:3015/api/payments/mpgs/payment/view?orders_id=1234" class="btn">
                Test with Order 1234
            </a>
        </div>
    </div>

    <div class="card">
        <h2>üß™ Test Cards for MPGS</h2>
        <ul>
            <li><strong>Mastercard:</strong> 5123456789012346</li>
            <li><strong>Visa:</strong> 4111111111111111</li>
            <li><strong>Expiry:</strong> 01/39</li>
            <li><strong>CVV:</strong> 100</li>
        </ul>
    </div>

    <script>
        async function createOrder() {
            try {
                const response = await fetch('/api/payments/mpgs/create-test-order', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ amount: '25.50', currency: 'JOD' })
                });

                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('orderResult').innerHTML = `
                        <div class="success">
                            <strong>‚úÖ Order Created: ${data.order.id}</strong><br>
                            Amount: ${data.order.total_amount} ${data.order.currency}<br><br>
                            <a href="${data.paymentUrl}" class="btn">Open Payment Page</a>
                        </div>
                    `;
                } else {
                    throw new Error(data.error || 'Failed to create order');
                }
            } catch (error) {
                document.getElementById('orderResult').innerHTML = `
                    <div class="error">‚ùå Error: ${error.message}</div>
                `;
            }
        }
    </script>
</body>
</html>
