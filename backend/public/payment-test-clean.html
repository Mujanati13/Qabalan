<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MPGS Payment Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f7fa;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #e1e5e9;
            border-radius: 6px;
        }
        button {
            background: #1677ff;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        button:hover {
            background: #0f5ec5;
        }
        .success {
            color: #52c41a;
            font-weight: bold;
        }
        .error {
            color: #ff4d4f;
            font-weight: bold;
        }
        input[type="text"] {
            padding: 8px 12px;
            border: 1px solid #d9d9d9;
            border-radius: 4px;
            margin: 0 10px;
            width: 120px;
        }
        .test-info {
            background: #f6ffed;
            border: 1px solid #b7eb8f;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß MPGS Payment Integration Test</h1>
        
        <div class="test-info">
            <strong>‚úÖ Clean Version Active</strong><br>
            This page tests the cleaned payments.js routes with no syntax errors.
        </div>

        <div class="section">
            <h3>1. Create Test Order</h3>
            <p>First, create a test order in the database:</p>
            <label>Amount: <input type="text" id="amount" value="25.50"></label>
            <label>Currency: <input type="text" id="currency" value="USD"></label>
            <button onclick="createTestOrder()">Create Test Order</button>
            <div id="order-result"></div>
        </div>

        <div class="section">
            <h3>2. Test Payment Flow</h3>
            <p>Once you have an order ID, test the payment flow:</p>
            <label>Order ID: <input type="text" id="orderId" placeholder="Enter order ID"></label>
            <button onclick="testPaymentFlow()">Open Payment Page</button>
            <div id="payment-result"></div>
        </div>

        <div class="section">
            <h3>3. Quick Tests</h3>
            <button onclick="testHPP()">Test HPP Flow</button>
            <button onclick="checkRoutes()">Check Routes Health</button>
            <div id="quick-results"></div>
        </div>

        <div class="section">
            <h3>4. Available Routes</h3>
            <ul>
                <li><code>GET /api/payments/mpgs/payment/view?orders_id=123</code> - Main payment page</li>
                <li><code>GET /api/payments/mpgs/payment/success</code> - Success callback</li>
                <li><code>POST /api/payments/mpgs/create-test-order</code> - Create test order</li>
                <li><code>GET /api/payments/mpgs/hpp/test</code> - HPP test form</li>
                <li><code>GET /api/payments/mpgs/debug-order/:orderId</code> - Debug order status</li>
            </ul>
        </div>
    </div>

    <script>
        async function createTestOrder() {
            const amount = document.getElementById('amount').value;
            const currency = document.getElementById('currency').value;
            const resultDiv = document.getElementById('order-result');
            
            try {
                const response = await fetch('/api/payments/mpgs/create-test-order', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ amount, currency })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('orderId').value = data.order.id;
                    resultDiv.innerHTML = `<div class="success">‚úÖ Order created: ID ${data.order.id}</div>
                                         <p>Payment URL: <a href="${data.paymentUrl}" target="_blank">${data.paymentUrl}</a></p>`;
                } else {
                    resultDiv.innerHTML = `<div class="error">‚ùå Failed to create order</div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">‚ùå Error: ${error.message}</div>`;
            }
        }
        
        function testPaymentFlow() {
            const orderId = document.getElementById('orderId').value;
            if (!orderId) {
                alert('Please enter an order ID first');
                return;
            }
            
            const paymentUrl = `/api/payments/mpgs/payment/view?orders_id=${orderId}`;
            window.open(paymentUrl, '_blank');
            
            document.getElementById('payment-result').innerHTML = 
                `<div class="success">‚úÖ Opened payment page for order ${orderId}</div>`;
        }
        
        function testHPP() {
            window.open('/api/payments/mpgs/hpp/test', '_blank');
            document.getElementById('quick-results').innerHTML = 
                '<div class="success">‚úÖ Opened HPP test page</div>';
        }
        
        async function checkRoutes() {
            const resultDiv = document.getElementById('quick-results');
            try {
                const response = await fetch('/api/payments/mpgs/hpp/test');
                if (response.ok) {
                    resultDiv.innerHTML = '<div class="success">‚úÖ Routes are healthy</div>';
                } else {
                    resultDiv.innerHTML = '<div class="error">‚ùå Routes check failed</div>';
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">‚ùå Routes error: ${error.message}</div>`;
            }
        }
    </script>
</body>
</html>
